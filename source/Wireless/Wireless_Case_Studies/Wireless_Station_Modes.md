# 无线基站模式概述

在任意一种模式下的无线接口将搜索可接受的接入点(AP)并连接到它。根据所使用的_station_模式的类型，站和AP之间的连接将以略有不同的方式运行，因此必须为给定的应用程序和设备选择正确的模式。本文试图描述可用的站点模式之间的差异。

_station_ 模式之间的主要区别在于L2地址在无线链路上的处理和转发方式。这直接影响到无线链路作为L2桥接基础设施一部分的能力。

如果不需要在无线链路上进行L2桥接，例如在路由或MPLS交换网络中，建议使用mode=station设置，这样可以提供最高的效率。

特定站台模式的可用性取决于无线网络中所使用的无线协议。请参考 [适用性矩阵](https://help.mikrotik.com/docs/display/ROS/Wireless+Station+Modes#WirelessStationModes-ApplicabilityMatrix) 了解协议中模式支持的信息。即使给定协议不支持特定模式，也有可能建立站与AP之间的连接。注意，这种连接在L2桥接方面不会像预期的那样运行。

# 802.11 L2桥接限制

从历史上看，802.11 AP设备应该能够在有线网络段和无线网络段之间桥接帧，但是站设备不应该做L2桥接。

考虑以下网络:

```
[X]---[AP]-(     )-[STA]---[Y]

```

其中X-to-AP和STA-to-Y是以太网链路，但AP-to-STA是无线连接。根据802.11,AP可以透明地桥接X和STA之间的流量，但不可能桥接AP和Y之间的流量，或者X和Y之间的流量。

802.11标准规定站与AP设备之间的帧必须以所谓的_3 address_帧格式传输，即帧头包含3个MAC地址。AP向站传输的帧有以下地址:

- 目的地址-电台设备的地址，也可以是无线电接收机地址
- 无线发射机地址- AP地址
- 源地址-特定帧的发送者的地址

从站到AP传输的帧有以下地址:

- radio receiver address - AP地址
- 源地址-电台设备的地址，也称为无线电发射机地址
- 目的地址

考虑到每一帧都必须包含无线电发送地址和接收地址，很明显，_3地址_ 帧格式不适合透明L2桥接站，因为站不能发送源地址与其地址不同的帧-例如来自Y的帧，同时AP不能以包含Y地址的方式格式化帧。

802.11包括额外的帧格式，称为4地址帧格式，用于“无线分配系统”(WDS)——一种无线连接ap的系统。在这种格式中，添加了额外的地址，产生包含以下地址的报头:

- 无线电接收机地址
- 无线电发射机地址
- 目的地址
- 源地址

这种帧格式包括无线链路上透明L2桥接所需的所有信息。不幸的是，802.11没有指定应该如何建立和管理WDS连接，因此对 _4地址_ 帧格式(和WDS)的任何使用都是特定于实现的。

不同的站模式试图解决标准站模式的缺点，为L2桥接提供支持。

# 适用性矩阵

下面的矩阵指定了每种无线协议可用的station模式。请注意，802.11协议有两列: **802.11** 指定“纯”802.11网络中模式的可用性(当连接到任何供应商AP时)，**ROS 802.11** 指定连接到RouterOS AP时模式的可用性，该AP实现了模式工作所需的专有扩展。

Table适用于RouterOS v5rc11及以上版本

|                                | 802.11 | ROS 802.11 | nstreme | nv2 |
| ------------------------------ | ------ | ---------- | ------- | --- |
| **station**                    | V      | V          | V       | V   |
| **station-wds**                |        | V          | V       | V   |
| **station-pseudobridge**       | V      | V          | V       |     |
| **station-pseudobridge-clone** | V      | V          | V       |     |
| **station-bridge**             |        | V          | V       | V   |

# _station_ 模式

这是标准模式，不支持站上的L2桥接——尝试将无线接口放在桥接中不会产生预期的结果。另一方面，这种模式可以被认为是最有效的，因此如果站上的L2桥接不是必要的，就应该使用这种模式——比如路由或MPLS交换网络。该模式支持所有无线协议。

# _station-wds_ 模式

该模式仅适用于RouterOS ap。协商连接的结果是在AP上为给定站点创建单独的WDS接口。这个接口可以看作是AP和给定站点之间的点对点连接——从WDS接口发送出去的任何内容都被传送到站点(并且仅传送到特定站点)，而站点发送给AP的任何内容都从WDS接口接收(并且不受AP客户端之间转发的影响)，从而保留L2地址。

除使用802.11协议连接非routeros设备外，所有无线协议均支持该模式。Mode与802.11协议配合使用时采用_4 address_帧格式，其他协议(如nstream、nv2)采用协议内部方式。

这种模式可以安全地用于L2桥接，并通过单独的WDS接口对AP进行大部分管理控制，例如使用桥接防火墙、用于环路检测和避免的RSTP等。

使用station-wd模式，无法连接到CAPsMAN控制的CAP。

# _station-pseudobridge_ 模式

从无线连接的角度来看，这种模式与标准站模式相同。通过在站内实施的一些服务，它对L2桥接的支持有限:

- IPv4报文的MAC地址转换—站维护IPv4-to-MAC映射表，在向AP发送帧时用自己的地址替换源MAC地址(为了能够使用_3 address_ frame格式)，从AP接收帧时用映射表中的地址替换目的MAC地址。VLAN封装帧也建立了IPv4-to-MAC映射。
- 其他协议的单一MAC地址转换-站从第一个转发的非ipv4帧中学习源MAC地址，并将其作为默认值进行反向转换-如果不能执行ipv4到MAC映射(例如-非ipv4帧或缺少映射)，则该MAC地址用于替换从AP接收的帧的目的MAC地址。

这种模式仅限于将数据完成L2桥接到连接到站点的单个设备(通过单个MAC地址转换)，并支持IPv4帧桥接——非ip协议桥接到多个设备将不起作用。此外，MAC地址转换限制了从AP端到基于IPv4的访问站点设备-其余协议将通过单个MAC地址转换进行转换，并且不会被站点本身接收。

此模式可用于除nv2之外的所有协议，并且应尽可能避免使用。只有当AP不支持更好的L2桥接模式时(例如，当使用非routeros AP时)，或者只有一个终端用户设备必须通过站设备连接到网络时，才有理由使用该模式。

# _station-pseudobridge-clone_ 模式

此模式与_station-pseudobridge_模式相同，不同之处是使用“克隆”MAC地址连接AP——即在station-bridge-clone-mac参数中配置的地址(如果配置了)或第一转发帧的源地址。这实际上显示在AP上，就像连接到连接到AP的站点的终端用户设备一样。

# _station-bridge_ 模式

该模式仅适用于RouterOS ap，支持站设备上与协议无关的透明L2桥接。当使用bridge-mode参数启用时，RouterOS AP以station-bridge模式接受客户端。在这种模式下，AP维护一个转发表，其中包含了通过哪个站设备可以访问的MAC地址的信息。

此模式是microtik专有的，不能用于连接其他品牌的设备。

这种模式对于L2桥接来说是安全的，并且是首选模式，除非有特殊的原因需要使用station-wds模式。在站桥模式下，不可能连接到CAPsMAN控制的CAP。